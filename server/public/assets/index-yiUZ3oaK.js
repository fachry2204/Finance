import{r as l,a as Ve,C as oe,D as ye,U as Y,L as Me,X as Z,b as Qe,c as Ye,F as V,P as Re,d as We,R as Ze,W as Ke,e as Be,S as et,T as tt,f as st,A as ae,g as at,B as lt,h as rt,i as nt,Y as it,j as dt,k as ot,l as ct,m as ie,n as le,o as Ge,p as we,q as W,s as $e,t as de,u as be,E as xt,v as Pe,w as De,x as Fe,y as Te,z as mt,G as ut,H as bt,I as ht,J as Se,K as pt,M as gt,N as he,O as Ee,Q as Ae,V as Le,Z as Ue,_ as jt}from"./vendor-PEGUMaOx.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const w of u.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function r(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function m(o){if(o.ep)return;o.ep=!0;const u=r(o);fetch(o.href,u)}})();var qe={exports:{}},ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft=l,Nt=Symbol.for("react.element"),vt=Symbol.for("react.fragment"),kt=Object.prototype.hasOwnProperty,yt=ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wt={key:!0,ref:!0,__self:!0,__source:!0};function _e(x,g,r){var m,o={},u=null,w=null;r!==void 0&&(u=""+r),g.key!==void 0&&(u=""+g.key),g.ref!==void 0&&(w=g.ref);for(m in g)kt.call(g,m)&&!wt.hasOwnProperty(m)&&(o[m]=g[m]);if(x&&x.defaultProps)for(m in g=x.defaultProps,g)o[m]===void 0&&(o[m]=g[m]);return{$$typeof:Nt,type:x,key:u,ref:w,props:o,_owner:yt.current}}ge.Fragment=vt;ge.jsx=_e;ge.jsxs=_e;qe.exports=ge;var e=qe.exports,Ce={},ze=Ve;Ce.createRoot=ze.createRoot,Ce.hydrateRoot=ze.hydrateRoot;const P=x=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(x),te=x=>{if(!x)return"-";const g=x.split("-");if(g.length===3){const m=g[0],o=parseInt(g[1])-1,u=g[2],w=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(w[o])return`${u} ${w[o]} ${m}`}const r={day:"numeric",month:"long",year:"numeric"};return new Date(x).toLocaleDateString("id-ID",r)},Je=()=>{const x={weekday:"long",day:"numeric",month:"long",year:"numeric"};return new Date().toLocaleDateString("id-ID",x)},pe=()=>Math.random().toString(36).substr(2,9),St=({user:x,onLogoutClick:g,toggleSidebar:r,connectionStatus:m})=>{const u=(()=>{switch(m){case"CONNECTED":return{text:"DB Online",color:"bg-emerald-50 border-emerald-100 text-emerald-700",dot:"bg-emerald-500 animate-pulse"};case"DB_ERROR":return{text:"DB Error",color:"bg-orange-50 border-orange-100 text-orange-700",dot:"bg-orange-500"};case"SERVER_ERROR":return{text:"Node JS Mati",color:"bg-rose-50 border-rose-100 text-rose-700",dot:"bg-rose-500"};default:return{text:"Unknown",color:"bg-slate-50 border-slate-100 text-slate-500",dot:"bg-slate-400"}}})();return e.jsxs("header",{className:"h-16 bg-white border-b border-slate-200 fixed top-0 left-0 right-0 z-40 px-4 md:px-6 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"md:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("img",{src:"https://fin.dmasiv.id/img/logodmsv.png",alt:"D'MASIV Finance",className:"h-10 w-auto object-contain"}),e.jsxs("span",{className:"font-bold text-lg text-slate-800 tracking-tight hidden md:block",children:["KEUANGAN ",e.jsx("span",{className:"text-blue-600",children:"D'MASIV"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-xs font-medium text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100",children:[e.jsx(oe,{size:14,className:"text-slate-400"}),Je()]}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium ${u.color}`,title:u.text,children:[e.jsx(ye,{size:14}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${u.dot}`}),u.text]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-100",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(Y,{size:16})}),e.jsxs("div",{className:"hidden md:block pr-2",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:(x==null?void 0:x.username)||"Admin"}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase leading-none",children:(x==null?void 0:x.role)||"User"})]})]}),e.jsx("button",{onClick:g,className:"p-2 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Keluar Sistem",children:e.jsx(Me,{size:20})})]})]})},Et=()=>e.jsx("footer",{className:"bg-white border-t border-slate-200 py-4 px-6 text-center md:text-left",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center text-sm text-slate-500",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold text-slate-700",children:"D'MASIV Finance"}),". All rights reserved."]}),e.jsx("p",{className:"mt-1 md:mt-0",children:"Build in Garuda Cyber"})]})}),At=({activePage:x,setActivePage:g,isOpen:r,setIsOpen:m})=>{const o=[{title:"Menu Utama",items:[{id:"DASHBOARD",label:"Dashboard",icon:Qe},{id:"JOURNAL_LIST",label:"Semua Jurnal",icon:Ye},{id:"REPORT",label:"Laporan Umum",icon:V}]},{title:"Pengeluaran",items:[{id:"STAT_EXPENSE",label:"Dashboard Cash Out",icon:Re},{id:"ADD_EXPENSE",label:"Tambah Pengeluaran",icon:We},{id:"REIMBURSE",label:"Tambah Reimburse",icon:Ze},{id:"REPORT_EXPENSE",label:"Laporan Pengeluaran",icon:V}]},{title:"Pemasukan",items:[{id:"ADD_INCOME",label:"Tambah Pemasukan",icon:Ke},{id:"STAT_INCOME",label:"Statistik Pemasukan",icon:Re}]},{title:"Lainnya",items:[{id:"EMPLOYEES",label:"Data Pegawai",icon:Be},{id:"SETTINGS",label:"Pengaturan",icon:et}]}];return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden",onClick:()=>m(!1)}),e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-slate-200 text-slate-700 transform transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:inset-0 ${r?"translate-x-0":"-translate-x-full"} flex flex-col pt-0`,children:[e.jsx("div",{className:"flex md:hidden items-center justify-end p-4 border-b border-slate-100",children:e.jsx("button",{onClick:()=>m(!1),className:"text-slate-500 hover:text-slate-800",children:e.jsx(Z,{size:24})})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-6 px-4 space-y-6",children:o.map((u,w)=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2",children:u.title}),e.jsx("div",{className:"space-y-1",children:u.items.map(A=>{const C=A.icon,j=x===A.id;return e.jsxs("button",{onClick:()=>{g(A.id),m(!1)},className:`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm ${j?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-600 hover:bg-blue-50 hover:text-blue-600"}`,children:[e.jsx(C,{size:18}),e.jsx("span",{className:"font-medium",children:A.label})]},A.id)})})]},w))}),e.jsx("div",{className:"p-4 text-xs text-center text-slate-400 border-t border-slate-100",children:"v1.0.0 Stable"})]})]})},ue=({transactions:x,reimbursements:g,isDarkMode:r,filterType:m="ALL"})=>{const[o,u]=l.useState(null),[w,A]=l.useState(null),C=l.useMemo(()=>{const d=x.filter(f=>f.type==="PEMASUKAN").reduce((f,E)=>f+E.grandTotal,0),p=x.filter(f=>f.type==="PENGELUARAN").reduce((f,E)=>f+E.grandTotal,0),v=g.filter(f=>f.status==="PENDING").reduce((f,E)=>f+E.grandTotal,0),K=d-p;return{totalIncome:d,totalExpense:p,totalReimbursePending:v,balance:K}},[x,g]),j=l.useMemo(()=>{let d=x;m==="INCOME"?d=x.filter(v=>v.type==="PEMASUKAN"):m==="EXPENSE"&&(d=x.filter(v=>v.type==="PENGELUARAN"));const p={};return d.forEach(v=>{p[v.category]||(p[v.category]=0),p[v.category]+=v.grandTotal}),Object.keys(p).map(v=>({name:v,value:p[v]})).slice(0,5)},[x,m]),T=()=>m==="INCOME"?"Statistik Pemasukan":m==="EXPENSE"?"Statistik Pengeluaran":"Dashboard Ringkasan",z=()=>m==="INCOME"?"Pemasukan per Kategori":m==="EXPENSE"?"Pengeluaran per Kategori":"Transaksi per Kategori";return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:T()}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(m==="ALL"||m==="INCOME")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pemasukan"}),e.jsx("h3",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:P(C.totalIncome)})]}),e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400",children:e.jsx(tt,{size:24})})]})}),(m==="ALL"||m==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pengeluaran"}),e.jsx("h3",{className:"text-2xl font-bold text-rose-600 dark:text-rose-400",children:P(C.totalExpense)})]}),e.jsx("div",{className:"p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg text-rose-600 dark:text-rose-400",children:e.jsx(st,{size:24})})]})}),(m==="ALL"||m==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Reimburse (Pending)"}),e.jsx("h3",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:P(C.totalReimbursePending)})]}),e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400",children:e.jsx(ae,{size:24})})]})}),m==="ALL"&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Saldo Akhir"}),e.jsx("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:P(C.balance)})]}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(Ke,{size:24})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"Transaksi Terakhir"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:[e.jsx("th",{className:"pb-3 px-3",children:"Tanggal"}),e.jsx("th",{className:"pb-3 px-3",children:"Kategori"}),e.jsx("th",{className:"pb-3 px-3 text-right",children:"Nominal"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[x.filter(d=>m==="ALL"||m==="INCOME"&&d.type==="PEMASUKAN"||m==="EXPENSE"&&d.type==="PENGELUARAN").slice(0,5).map(d=>e.jsxs("tr",{onClick:()=>u(d),className:"text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600 dark:text-slate-300",children:te(d.date)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${d.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:d.category})}),e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${d.type==="PEMASUKAN"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:[d.type==="PEMASUKAN"?"+":"-"," ",P(d.grandTotal)]})]},d.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data transaksi"})})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:z()}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(at,{width:"100%",height:"100%",children:e.jsxs(lt,{data:j,children:[e.jsx(rt,{strokeDasharray:"3 3",vertical:!1,stroke:r?"#334155":"#e2e8f0"}),e.jsx(nt,{dataKey:"name",fontSize:12,tickLine:!1,axisLine:!1,tick:{fill:r?"#94a3b8":"#64748b"}}),e.jsx(it,{fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:d=>`${d/1e3}k`,tick:{fill:r?"#94a3b8":"#64748b"}}),e.jsx(dt,{formatter:d=>P(d),cursor:{fill:r?"#334155":"#f8fafc"},contentStyle:{backgroundColor:r?"#1e293b":"#fff",borderColor:r?"#334155":"#e2e8f0",color:r?"#f1f5f9":"#1e293b"},itemStyle:{color:r?"#e2e8f0":"#1e293b"}}),e.jsx(ot,{dataKey:"value",fill:m==="INCOME"?"#10b981":m==="EXPENSE"?"#f43f5e":"#3b82f6",radius:[4,4,0,0],children:j.map((d,p)=>e.jsx(ct,{fill:m==="INCOME"?p%2===0?"#10b981":"#34d399":m==="EXPENSE"?p%2===0?"#f43f5e":"#fb7185":p%2===0?"#3b82f6":"#60a5fa"},`cell-${p}`))})]})})})]})]}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",o.id]})]}),e.jsx("button",{onClick:d=>{d.stopPropagation(),u(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Z,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${o.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[o.type==="PEMASUKAN"?e.jsx(ie,{size:24}):e.jsx(le,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[o.type," ",o.expenseType?`(${o.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:P(o.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(oe,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:te(o.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(le,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:o.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:o.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:o.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(V,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o.items.map((d,p)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:d.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:d.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(d.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:P(d.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:d.filePreviewUrl?e.jsxs("button",{onClick:()=>A(d.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Ge,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},p))})]})})]})]})]})}),w&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>A(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>A(null),children:e.jsx(Z,{size:32})}),e.jsxs("div",{className:"relative",onClick:d=>d.stopPropagation(),children:[e.jsx("img",{src:w,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:d=>{var v;const p=d.target;p.onerror=null,p.style.display="none",(v=p.nextElementSibling)==null||v.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ae,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},ke=({onAddTransaction:x,onUpdateTransaction:g,onDeleteTransaction:r,transactions:m,defaultType:o="PENGELUARAN",filterType:u,initialView:w="LIST",categories:A,authToken:C})=>{const[j,T]=l.useState(w),[z,d]=l.useState(!1),[p,v]=l.useState(null),[K,f]=l.useState(null),[E,R]=l.useState(new Date().toISOString().split("T")[0]),[B,G]=l.useState(o),[U,n]=l.useState("NORMAL"),[c,O]=l.useState(""),[D,L]=l.useState(""),[I,$]=l.useState(""),[h,S]=l.useState([]),[M,_]=l.useState(null),[X,s]=l.useState(null);l.useEffect(()=>{T(w),G(o),o==="PENGELUARAN"&&n("NORMAL")},[w,o]);const N=l.useMemo(()=>u?m.filter(a=>a.type===u):m,[m,u]),y=()=>{const a=pe();S([...h,{id:a,name:"",qty:1,price:0,total:0}]),_(a)},F=a=>{S(h.filter(b=>b.id!==a)),M===a&&_(null)},J=a=>{const b=h.find(t=>t.id===a);if(b){if(!b.name.trim()||b.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}_(null)}},H=(a,b,t)=>{S(h.map(i=>{if(i.id===a){const k={...i,[b]:t};return(b==="qty"||b==="price")&&(k.total=Number(k.qty)*Number(k.price)),k}return i}))},ee=(a,b)=>{S(h.map(t=>{if(t.id===a){const i=b?URL.createObjectURL(b):void 0;return{...t,file:b,filePreviewUrl:i}}return t}))},se=()=>h.reduce((a,b)=>a+b.total,0),ce=async a=>{if(!C)return alert("Sesi habis. Silakan login ulang."),"";const b=new FormData;b.append("file",a);try{const i=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${C}`},body:b})).json();if(i.status==="success")return i.url;throw new Error(i.message||"Upload gagal")}catch(t){return console.error("Upload Error:",t),""}},xe=async a=>{if(a.preventDefault(),M){const b=h.find(t=>t.id===M);if(b&&(!b.name.trim()||b.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(!c||!D||h.length===0){alert("Mohon lengkapi data wajib dan minimal 1 item.");return}d(!0);try{const b=await Promise.all(h.map(async i=>{let k=i.filePreviewUrl;if(i.file){const ve=await ce(i.file);ve&&(k=ve)}const{file:q,...Q}=i;return{...Q,filePreviewUrl:k}})),t={id:K||pe(),date:E,type:B,expenseType:B==="PENGELUARAN"?U:void 0,category:c,activityName:D,description:I,items:b,grandTotal:se(),timestamp:Date.now()};K?(g(t),alert("Transaksi berhasil diperbarui")):x(t),T("LIST"),re()}catch(b){console.error("Gagal menyimpan transaksi:",b),alert("Terjadi kesalahan saat menyimpan transaksi.")}finally{d(!1)}},re=()=>{R(new Date().toISOString().split("T")[0]),O(""),L(""),$(""),S([]),_(null),f(null)},ne=(a,b)=>{a.stopPropagation(),f(b.id),R(b.date),G(b.type),n(b.expenseType||"NORMAL"),O(b.category),L(b.activityName),$(b.description),S(b.items.map(t=>({...t}))),T("FORM")},je=(a,b)=>{a.stopPropagation(),window.confirm("Apakah Anda yakin ingin menghapus transaksi ini? Data yang dihapus tidak dapat dikembalikan.")&&r(b)},fe=()=>j==="FORM"?K?"Edit Transaksi":B==="PEMASUKAN"?"Tambah Pemasukan":"Tambah Pengeluaran":u==="PENGELUARAN"?"Data Pengeluaran":u==="PEMASUKAN"?"Data Pemasukan":"Daftar Jurnal Transaksi",me=()=>u==="PENGELUARAN"?"+ Tambah Pengeluaran":u==="PEMASUKAN"?"+ Tambah Pemasukan":"+ Tambah Transaksi",Ne=!!u;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:fe()}),j==="LIST"?e.jsx("button",{onClick:()=>{re(),T("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:me()}):e.jsx("button",{onClick:()=>{re(),T("LIST")},className:"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),j==="FORM"?e.jsxs("form",{onSubmit:xe,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal"}),e.jsx("input",{type:"date",required:!0,value:E,onChange:a=>R(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"})]}),(!Ne||K)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Transaksi"}),e.jsxs("select",{value:B,onChange:a=>G(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"})]})]}),B==="PENGELUARAN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Pengeluaran"}),e.jsxs("select",{value:U,onChange:a=>n(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"NORMAL",children:"Normal"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori Kegiatan"}),e.jsxs("select",{required:!0,value:c,onChange:a=>O(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),A.map((a,b)=>e.jsx("option",{value:a,children:a},b))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,placeholder:"Contoh: Pembelian ATK Bulanan",value:D,onChange:a=>L(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan Tambahan"}),e.jsx("textarea",{rows:2,value:I,onChange:a=>$(a.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item"}),e.jsx("button",{type:"button",onClick:y,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsxs("div",{className:"space-y-4",children:[h.map(a=>{const b=M===a.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center relative transition-colors ${b?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Nama Item"}),e.jsx("input",{type:"text",placeholder:"Nama barang/jasa",value:a.name,onChange:t=>H(a.id,"name",t.target.value),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:a.qty,onChange:t=>H(a.id,"qty",parseInt(t.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga Satuan"}),e.jsx("input",{type:"number",min:"0",value:a.price,onChange:t=>H(a.id,"price",parseInt(t.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-between items-end",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 rounded border border-slate-200 dark:border-slate-600 text-sm font-medium text-slate-700 dark:text-slate-200",children:P(a.total)})]})}),e.jsxs("div",{className:"md:col-span-12 flex items-center justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(we,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:t=>ee(a.id,t.target.files?t.target.files[0]:null)})]}),a.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:a.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>F(a.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(W,{size:16})}),e.jsx("button",{type:"button",onClick:()=>J(a.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx($e,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:a.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:a.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:P(a.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:P(a.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[a.filePreviewUrl&&e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),s(a.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(V,{size:16})}),e.jsx("button",{type:"button",onClick:()=>_(a.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(de,{size:16})}),e.jsx("button",{type:"button",onClick:()=>F(a.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(W,{size:16})})]})]})]})},a.id)}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 dark:text-slate-500 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-lg",children:"Belum ada item ditambahkan"})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:P(se())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",disabled:z,onClick:()=>{re(),T("LIST")},className:"px-6 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:z,className:"px-6 py-2.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium shadow-sm shadow-blue-200 dark:shadow-none transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:z?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," ",K?"Update Transaksi":"Simpan Transaksi"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),!u&&e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:N.length>0?N.sort((a,b)=>b.timestamp-a.timestamp).map(a=>e.jsxs("tr",{onClick:()=>v(a),className:"hover:bg-blue-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer even:bg-slate-50 dark:even:bg-slate-800",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:te(a.date)}),!u&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:a.type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:a.category}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"font-medium",children:a.activityName}),e.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[200px]",children:a.description})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[a.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-800 dark:text-slate-200 text-right",children:P(a.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:b=>ne(b,a),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded transition-colors",title:"Edit",children:e.jsx(de,{size:16})}),e.jsx("button",{onClick:b=>je(b,a.id),className:"p-1.5 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Hapus",children:e.jsx(W,{size:16})})]})})]},a.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:u?6:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:["Belum ada data ",u?u.toLowerCase():"jurnal"]})})})]})})}),p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",p.id]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),v(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Z,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${p.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[p.type==="PEMASUKAN"?e.jsx(ie,{size:24}):e.jsx(le,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[p.type," ",p.expenseType?`(${p.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:P(p.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(oe,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:te(p.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(le,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:p.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:p.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:p.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(V,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:p.items.map((a,b)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:a.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:a.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(a.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:P(a.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:a.filePreviewUrl?e.jsxs("button",{onClick:()=>s(a.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Ge,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},b))})]})})]})]})]})})]}),X&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>s(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>s(null),children:e.jsx(Z,{size:32})}),e.jsxs("div",{className:"relative",onClick:a=>a.stopPropagation(),children:[e.jsx("img",{src:X,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:a=>{var t;const b=a.target;b.onerror=null,b.style.display="none",(t=b.nextElementSibling)==null||t.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ae,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},Ct=({reimbursements:x,onAddReimbursement:g,onUpdateReimbursement:r,onDeleteReimbursement:m,onUpdateReimbursementDetails:o,categories:u,authToken:w})=>{const[A,C]=l.useState("LIST"),[j,T]=l.useState(null),[z,d]=l.useState(!1),[p,v]=l.useState(null),[K,f]=l.useState(new Date().toISOString().split("T")[0]),[E,R]=l.useState(""),[B,G]=l.useState(""),[U,n]=l.useState(""),[c,O]=l.useState(""),[D,L]=l.useState([]),[I,$]=l.useState(null),[h,S]=l.useState(null),[M,_]=l.useState(null),[X,s]=l.useState(""),[N,y]=l.useState(null),F=()=>{const t=pe();L([...D,{id:t,name:"",qty:1,price:0,total:0}]),$(t)},J=t=>{L(D.filter(i=>i.id!==t)),I===t&&$(null)},H=t=>{const i=D.find(k=>k.id===t);if(i){if(!i.name.trim()||i.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}$(null)}},ee=(t,i,k)=>{L(D.map(q=>{if(q.id===t){const Q={...q,[i]:k};return(i==="qty"||i==="price")&&(Q.total=Number(Q.qty)*Number(Q.price)),Q}return q}))},se=(t,i)=>{L(D.map(k=>k.id===t?{...k,file:i,filePreviewUrl:i?URL.createObjectURL(i):void 0}:k))},ce=()=>D.reduce((t,i)=>t+i.total,0),xe=async t=>{if(!w)return alert("Sesi habis. Silakan login ulang."),"";const i=new FormData;i.append("file",t);try{const q=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${w}`},body:i})).json();if(q.status==="success")return q.url;throw new Error(q.message||"Upload gagal")}catch(k){return console.error("Upload Error:",k),""}},re=async t=>{if(t.preventDefault(),I){const i=D.find(k=>k.id===I);if(i&&(!i.name.trim()||i.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(D.length===0)return alert("Minimal 1 item reimburse.");if(!B)return alert("Silakan pilih kategori.");d(!0);try{const i=await Promise.all(D.map(async q=>{let Q=q.filePreviewUrl;if(q.file){const Ie=await xe(q.file);Ie&&(Q=Ie)}const{file:ve,...Xe}=q;return{...Xe,filePreviewUrl:Q}})),k={id:p||pe(),date:K,requestorName:E,category:B,activityName:U,description:c,items:i,grandTotal:ce(),status:"PENDING",timestamp:Date.now()};p?(o(k),alert("Data reimburse berhasil diperbarui")):g(k),C("LIST"),ne()}catch(i){console.error("Gagal menyimpan reimburse:",i),alert("Terjadi kesalahan.")}finally{d(!1)}},ne=()=>{v(null),f(new Date().toISOString().split("T")[0]),R(""),G(""),n(""),O(""),L([]),$(null)},je=(t,i)=>{if(t.stopPropagation(),i.status!=="PENDING"){alert("Hanya pengajuan berstatus PENDING yang dapat diedit.");return}v(i.id),f(i.date),R(i.requestorName),G(i.category),n(i.activityName),O(i.description),L(i.items.map(k=>({...k}))),C("FORM")},fe=(t,i)=>{if(t.stopPropagation(),i.status!=="PENDING"){alert("Hanya pengajuan berstatus PENDING yang dapat dihapus.");return}window.confirm("Yakin ingin menghapus pengajuan reimburse ini?")&&m(i.id)},me=t=>{switch(t){case"PENDING":return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";case"PROSES":return"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300";case"BERHASIL":return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300";case"DITOLAK":return"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300";default:return"bg-slate-100 text-slate-800"}},Ne=t=>{switch(t){case"PENDING":return e.jsx(mt,{size:14,className:"mr-1"});case"PROSES":return e.jsx(De,{size:14,className:"mr-1 animate-spin-slow"});case"BERHASIL":return e.jsx(Te,{size:14,className:"mr-1"});case"DITOLAK":return e.jsx(Fe,{size:14,className:"mr-1"})}},a=t=>{T(t),S(t.status),_(null),s(t.rejectionReason||"")},b=async()=>{if(!(!j||!h)){if(h==="BERHASIL"&&!M&&!j.transferProofUrl){alert("Wajib upload bukti transfer untuk mengubah status menjadi Berhasil.");return}if(h==="DITOLAK"&&!X.trim()){alert("Wajib mengisi alasan penolakan jika status Ditolak.");return}d(!0);try{let t=j.transferProofUrl;if(M){const k=await xe(M);k&&(t=k)}const i={...j,status:h,transferProofUrl:t,rejectionReason:h==="DITOLAK"?X:void 0};r(i),T(null)}catch{alert("Gagal update status")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Tambah Reimburse"}),A==="LIST"?e.jsxs("button",{onClick:()=>{ne(),C("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:[e.jsx(ie,{size:18})," Ajukan Reimburse"]}):e.jsx("button",{onClick:()=>{ne(),C("LIST")},className:"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),A==="FORM"?e.jsxs("form",{onSubmit:re,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal Pengajuan"}),e.jsx("input",{type:"date",required:!0,value:K,onChange:t=>f(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Pengaju"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,placeholder:"Nama Lengkap",value:E,onChange:t=>R(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 pl-10 focus:ring-blue-500 outline-none transition-colors"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori"}),e.jsxs("select",{required:!0,value:B,onChange:t=>G(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),u.map((t,i)=>e.jsx("option",{value:t,children:t},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,value:U,onChange:t=>n(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan"}),e.jsx("textarea",{rows:2,value:c,onChange:t=>O(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item Reimburse"}),e.jsx("button",{type:"button",onClick:F,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsx("div",{className:"space-y-4",children:D.map(t=>{const i=I===t.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center transition-colors ${i?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Keterangan Barang/Jasa"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:k=>ee(t.id,"name",k.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",required:!0,min:"1",value:t.qty,onChange:k=>ee(t.id,"qty",parseInt(k.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga"}),e.jsx("input",{type:"number",required:!0,min:"0",value:t.price,onChange:k=>ee(t.id,"price",parseInt(k.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-200 rounded text-sm font-medium",children:P(t.total)})]}),e.jsxs("div",{className:"md:col-span-12 flex justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(we,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:k=>{var q;return se(t.id,((q=k.target.files)==null?void 0:q[0])||null)}})]}),t.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:t.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(t.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(W,{size:16})}),e.jsx("button",{type:"button",onClick:()=>H(t.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx($e,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:t.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:t.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:P(t.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:P(t.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[t.filePreviewUrl&&e.jsx("button",{type:"button",onClick:k=>{k.preventDefault(),k.stopPropagation(),y(t.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(V,{size:16})}),e.jsx("button",{type:"button",onClick:()=>$(t.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(de,{size:16})}),e.jsx("button",{type:"button",onClick:()=>J(t.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(W,{size:16})})]})]})]})},t.id)})}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total Reimburse"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:P(ce())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",disabled:z,onClick:()=>{ne(),C("LIST")},className:"px-6 py-2.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:z,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm shadow-blue-200 dark:shadow-none transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:z?"Memproses...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," ",p?"Update Pengajuan":"Simpan Pengajuan"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Pengaju"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:x.length>0?x.sort((t,i)=>i.timestamp-t.timestamp).map(t=>e.jsxs("tr",{onClick:()=>a(t),className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:te(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-700 dark:text-slate-300",children:t.requestorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:[e.jsx("div",{children:t.activityName}),e.jsx("div",{className:"text-xs text-slate-400",children:t.category})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[t.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-slate-800 dark:text-slate-200",children:P(t.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${me(t.status)}`,children:[Ne(t.status)," ",t.status]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),a(t)},className:"text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 p-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg transition-colors",title:"Lihat Detail",children:e.jsx(xt,{size:18})}),t.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>je(i,t),className:"text-slate-500 hover:text-blue-600 p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Edit",children:e.jsx(de,{size:18})}),e.jsx("button",{onClick:i=>fe(i,t),className:"text-slate-500 hover:text-rose-600 p-1 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Hapus",children:e.jsx(W,{size:18})})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data reimburse"})})})]})}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:["Detail Reimburse",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border ${me(j.status)}`,children:j.status})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",j.id]})]}),e.jsx("button",{onClick:()=>T(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Z,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[j.status==="DITOLAK"&&j.rejectionReason&&e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-200 dark:border-rose-800 flex gap-3",children:[e.jsx(ae,{className:"text-rose-600 dark:text-rose-400 shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-rose-700 dark:text-rose-300",children:"Pengajuan Ditolak"}),e.jsx("p",{className:"text-sm text-rose-600 dark:text-rose-400 mt-1",children:j.rejectionReason})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Pengaju"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:j.requestorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Tanggal"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:te(j.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:j.activityName}),e.jsx("p",{className:"text-xs text-slate-500",children:j.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Keterangan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:j.description||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-white mb-3",children:"Item Pengajuan"}),e.jsx("div",{className:"border rounded-lg border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800",children:j.items.map((t,i)=>e.jsxs("tr",{className:"even:bg-slate-50 dark:even:bg-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-slate-700 dark:text-slate-300",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-600 dark:text-slate-400",children:t.qty}),e.jsx("td",{className:"px-4 py-2 text-right text-slate-600 dark:text-slate-400",children:P(t.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-slate-800 dark:text-slate-200",children:P(t.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:t.filePreviewUrl?e.jsx("button",{onClick:()=>y(t.filePreviewUrl||null),className:"text-blue-500 hover:underline flex justify-center",children:e.jsx(V,{size:16})}):"-"})]},i))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700/50 font-bold text-slate-800 dark:text-white border-t border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Grand Total"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(j.grandTotal)}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-5 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Y,{size:18})," Aksi Admin"]}),j.status==="BERHASIL"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 font-medium p-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[e.jsx(Pe,{size:18})," Status Final: BERHASIL"]}),e.jsx("p",{className:"text-xs text-slate-500 ml-1",children:"Data yang sudah berhasil tidak dapat diubah kembali."}),j.transferProofUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Bukti Transfer:"}),e.jsxs("button",{onClick:()=>y(j.transferProofUrl||null),className:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(V,{size:16})," Lihat Bukti Transfer"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:["PENDING","PROSES","BERHASIL","DITOLAK"].map(t=>e.jsx("button",{onClick:()=>S(t),className:`px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${h===t?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:t},t))}),h==="BERHASIL"&&e.jsxs("div",{className:"animate-fade-in p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Upload Bukti Transfer ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm transition-colors shadow-sm font-medium",children:[e.jsx(we,{size:16})," Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:t=>_(t.target.files?t.target.files[0]:null)})]}),e.jsx("span",{className:"text-sm text-slate-500 truncate max-w-[200px]",children:M?M.name:j.transferProofUrl?"File sudah ada (ganti jika perlu)":"Belum ada file dipilih"})]})]}),h==="DITOLAK"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("textarea",{value:X,onChange:t=>s(t.target.value),placeholder:"Contoh: Bukti struk kurang jelas / Nominal tidak sesuai.",rows:3,className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-3 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("button",{onClick:b,disabled:z,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-sm transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[z?e.jsx(De,{size:18,className:"animate-spin"}):e.jsx(be,{size:18})," Simpan Perubahan"]})})]})]})]})]})}),N&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>y(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>y(null),children:e.jsx(Z,{size:32})}),e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:N,alt:"Bukti Reimburse",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:t=>{var k;const i=t.target;i.onerror=null,i.style.display="none",(k=i.nextElementSibling)==null||k.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ae,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})]})},Oe=({transactions:x,reimbursements:g,fixedFilterType:r,categories:m})=>{const[o,u]=l.useState("ALL"),[w,A]=l.useState(""),[C,j]=l.useState(""),[T,z]=l.useState(""),[d,p]=l.useState(null),[v,K]=l.useState("ALL");l.useEffect(()=>{u(r||"ALL")},[r]);const f=l.useMemo(()=>{let n=[...x.map(c=>({id:c.id,date:c.date,type:c.type,subType:c.expenseType||"NORMAL",category:c.category,activity:c.activityName,total:c.grandTotal,desc:c.description,timestamp:c.timestamp,source:"JURNAL",raw:c})),...g.filter(c=>c.status==="BERHASIL").map(c=>({id:c.id,date:c.date,type:"PENGELUARAN",subType:"REIMBURSE",category:c.category,activity:c.activityName,total:c.grandTotal,desc:`Reimburse oleh: ${c.requestorName} - ${c.description}`,timestamp:c.timestamp,source:"REIMBURSE_MODULE",raw:c}))];return w&&(n=n.filter(c=>c.date>=w)),C&&(n=n.filter(c=>c.date<=C)),o!=="ALL"&&(n=n.filter(c=>c.type===o||o==="REIMBURSE"&&c.subType==="REIMBURSE")),r==="PENGELUARAN"&&v!=="ALL"&&(n=n.filter(c=>c.subType===v)),T&&(n=n.filter(c=>c.category===T)),n.sort((c,O)=>O.timestamp-c.timestamp)},[x,g,w,C,o,T,r,v]),E=l.useMemo(()=>({income:f.filter(n=>n.type==="PEMASUKAN").reduce((n,c)=>n+c.total,0),expense:f.filter(n=>n.type==="PENGELUARAN").reduce((n,c)=>n+c.total,0),reimburse:f.filter(n=>n.subType==="REIMBURSE").reduce((n,c)=>n+c.total,0)}),[f]),R=()=>{window.print()},B=()=>{const n=["Tanggal","Jenis","Sub Jenis","Kategori","Kegiatan","Deskripsi","Total"],c=f.map(I=>[I.date,I.type,I.subType,I.category,I.activity,`"${I.desc}"`,I.total]),O="data:text/csv;charset=utf-8,"+n.join(",")+`
`+c.map(I=>I.join(",")).join(`
`),D=encodeURI(O),L=document.createElement("a");L.setAttribute("href",D),L.setAttribute("download",`laporan_keuangan_${new Date().toISOString()}.csv`),document.body.appendChild(L),L.click(),document.body.removeChild(L)},G=()=>r==="PENGELUARAN"?"Laporan Pengeluaran (Cash Out)":"Laporan Keuangan",U=()=>new Date().toLocaleString("id-ID",{dateStyle:"full",timeStyle:"medium"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1.5cm; }
          body { 
            background: white; 
            color: black; 
            font-size: 12px;
          }
          /* Hide non-printable areas */
          .no-print, nav, header, footer, .sidebar, button, input, select, .summary-cards {
            display: none !important;
          }
          /* Show print specific areas */
          .print-header, .print-footer {
            display: block !important;
          }
          /* Ensure table looks good */
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          thead { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
          tr.even { background-color: #f9f9f9 !important; -webkit-print-color-adjust: exact; }
          
          /* Main container adjustment */
          .main-content { margin: 0; padding: 0; overflow: visible; }
        }
        /* Default hide print areas */
        .print-header, .print-footer { display: none; }
      `}),e.jsxs("div",{className:"print-header mb-6 text-center border-b-2 border-slate-800 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold uppercase tracking-wider text-slate-900",children:"System Informasi Finance"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Ruang Dimensi Records"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:G()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:B,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors",children:[e.jsx(ut,{size:18})," Excel"]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-slate-800 dark:bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-900 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(bt,{size:18})," Print / PDF"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 grid grid-cols-1 md:grid-cols-4 gap-4 transition-colors no-print",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Dari Tanggal"}),e.jsx("input",{type:"date",value:w,onChange:n=>A(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",value:C,onChange:n=>j(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),r?r==="PENGELUARAN"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Jenis"}),e.jsxs("select",{value:v,onChange:n=>K(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua (Cash & Reimburse)"}),e.jsx("option",{value:"NORMAL",children:"Pengeluaran (Cash/Tunai)"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse (Ganti Uang)"})]})]}):null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Jenis Laporan"}),e.jsxs("select",{value:o,onChange:n=>u(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua Transaksi"}),e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"}),e.jsx("option",{value:"REIMBURSE",children:"Khusus Reimburse"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Kategori"}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-2.5 top-2.5 text-slate-400",size:14}),e.jsxs("select",{value:T,onChange:n=>z(n.target.value),className:"w-full p-2 pl-8 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"Semua Kategori"}),m.map((n,c)=>e.jsx("option",{value:n,children:n},c))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 summary-cards no-print",children:[(!r||r==="PEMASUKAN")&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-100 dark:border-emerald-800",children:[e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold uppercase",children:"Total Pemasukan"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-300",children:P(E.income)})]}),(!r||r==="PENGELUARAN")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-100 dark:border-rose-800",children:[e.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400 font-semibold uppercase",children:"Total Pengeluaran (Cash)"}),e.jsx("p",{className:"text-xl font-bold text-rose-700 dark:text-rose-300",children:P(E.expense-E.reimburse)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-100 dark:border-amber-800",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold uppercase",children:"Total Reimburse (Cair)"}),e.jsx("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:P(E.reimburse)})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold uppercase",children:"Total Cash Out"}),e.jsx("p",{className:"text-xl font-bold text-slate-700 dark:text-slate-200",children:P(E.expense)})]})]}),!r&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold uppercase",children:"Saldo Periode Ini"}),e.jsx("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:P(E.income-E.expense)})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori & Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:f.length>0?f.map((n,c)=>e.jsxs("tr",{onClick:()=>p(n),className:`hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer ${c%2===0?"even":"odd"}`,children:[e.jsx("td",{className:"px-6 py-3 text-sm text-slate-600 dark:text-slate-300 whitespace-nowrap",children:te(n.date)}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase ${n.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:n.type}),n.subType==="REIMBURSE"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border border-amber-200 dark:border-amber-800",children:"REIMBURSE"}),n.subType==="NORMAL"&&n.type==="PENGELUARAN"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600",children:"TUNAI"})]})}),e.jsxs("td",{className:"px-6 py-3 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:n.activity}),e.jsx("div",{className:"text-xs text-slate-400",children:n.category})]}),e.jsx("td",{className:"px-6 py-3 text-sm text-slate-500 dark:text-slate-400 max-w-xs truncate",children:n.desc}),e.jsx("td",{className:`px-6 py-3 text-sm font-bold text-right ${n.type==="PEMASUKAN"?"text-emerald-700 dark:text-emerald-400":"text-rose-700 dark:text-rose-400"}`,children:P(n.total)})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Tidak ada data laporan yang sesuai filter"})})})]})})}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in no-print",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",d.id]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),p(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Z,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${d.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[d.type==="PEMASUKAN"?e.jsx(ie,{size:24}):e.jsx(le,{size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.type,d.subType==="REIMBURSE"?" (REIMBURSE)":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total"}),e.jsx("p",{className:"font-bold text-lg",children:P(d.total)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(oe,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:te(d.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(le,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:d.activity})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 dark:text-white bg-slate-50 dark:bg-slate-700 p-3 rounded-lg border border-slate-100 dark:border-slate-600",children:d.desc||"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Sumber Data"}),e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-mono bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:d.source})]})]}),d.raw&&d.raw.items&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(V,{size:16})," Items"]}),e.jsx("div",{className:"text-sm border rounded overflow-hidden dark:border-slate-600",children:d.raw.items.map((n,c)=>e.jsxs("div",{className:"flex justify-between p-2 border-b last:border-0 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50",children:[e.jsxs("span",{children:[n.name," ",e.jsxs("span",{className:"text-slate-400",children:["x",n.qty]})]}),e.jsx("span",{className:"font-medium",children:P(n.total)})]},c))})]})]})]})}),e.jsx("div",{className:"print-footer mt-10 pt-4 border-t border-slate-400 text-right text-sm text-slate-600",children:e.jsxs("p",{children:["Dicetak / Didownload Tanggal : ",U()]})})]})},Pt=({settings:x,onUpdateSettings:g,authToken:r})=>{const[m,o]=l.useState("GENERAL"),[u,w]=l.useState(""),[A,C]=l.useState(x.database),[j,T]=l.useState([]),[z,d]=l.useState(""),[p,v]=l.useState(""),[K,f]=l.useState(!1),[E,R]=l.useState(!1),[B,G]=l.useState(!1),[U,n]=l.useState(null);l.useEffect(()=>{m==="USERS"&&r&&c()},[m,r]);const c=async()=>{if(r)try{const S=await(await fetch("/api/users",{headers:{Authorization:`Bearer ${r}`}})).json();Array.isArray(S)&&T(S)}catch{console.error("Failed to fetch users")}},O=async h=>{h.preventDefault();const S=u.trim();if(!(!S||x.categories.includes(S))){if(r){R(!0);try{const _=await(await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({name:S})})).json();if(!_.success){alert(_.message||"Gagal menambahkan kategori ke server"),R(!1);return}}catch{alert("Gagal menghubungi server"),R(!1);return}R(!1)}g({...x,categories:[...x.categories,S]}),w("")}},D=async h=>{if(confirm(`Hapus kategori "${h}"?`)){if(r)try{if(!(await(await fetch(`/api/categories/${encodeURIComponent(h)}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).json()).success){alert("Gagal menghapus kategori di server");return}}catch{alert("Gagal menghubungi server");return}g({...x,categories:x.categories.filter(S=>S!==h)})}},L=async h=>{if(h.preventDefault(),!(!z.trim()||!p.trim())){if(!r)return alert("Sesi habis");f(!0);try{const M=await(await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({username:z,password:p})})).json();M.success?(d(""),v(""),c(),alert("User berhasil dibuat!")):alert(M.message)}catch{alert("Gagal membuat user")}finally{f(!1)}}},I=async h=>{if(confirm("Yakin ingin menghapus user ini?")){if(!r)return alert("Sesi habis");try{(await(await fetch(`/api/users/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).json()).success&&c()}catch{alert("Gagal hapus user")}}},$=async()=>{G(!0),n(null);try{const S=await(await fetch("/api/test-db")).json();if(S.status==="success")C(M=>({...M,isConnected:!0})),n({type:"success",text:S.message}),g({...x,database:{...A,isConnected:!0}});else throw new Error(S.message)}catch(h){n({type:"error",text:h.message||"Gagal terkoneksi ke server."})}finally{G(!1)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Pengaturan Aplikasi"}),e.jsxs("div",{className:"flex space-x-1 bg-slate-100 p-1 rounded-xl w-fit overflow-x-auto",children:[e.jsx("button",{onClick:()=>o("GENERAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${m==="GENERAL"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Kategori"}),e.jsx("button",{onClick:()=>o("USERS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${m==="USERS"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Manajemen User"}),e.jsx("button",{onClick:()=>o("DATABASE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${m==="DATABASE"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Database"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[m==="GENERAL"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(le,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Kategori Kegiatan"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Kelola kategori untuk dropdown input."})]})]}),e.jsxs("form",{onSubmit:O,className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Nama Kategori Baru...",value:u,onChange:h=>w(h.target.value),className:"flex-1 rounded-lg border-slate-300 bg-slate-50 text-slate-900 border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none",disabled:E}),e.jsxs("button",{type:"submit",disabled:!u.trim()||E,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[E?e.jsx(Se,{size:18,className:"animate-spin"}):e.jsx(ie,{size:18})," Tambah"]})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:x.categories.map((h,S)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100 group hover:border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:h}),e.jsx("button",{onClick:()=>D(h),className:"text-slate-400 hover:text-rose-500 p-1",children:e.jsx(W,{size:16})})]},S))})]}),m==="USERS"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(Be,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Manajemen User"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Tambah atau hapus akses pengguna sistem."})]})]}),e.jsxs("form",{onSubmit:L,className:"bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(pt,{size:16})," Tambah User Baru"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:z,onChange:h=>d(h.target.value),className:"p-2 rounded border border-slate-300 text-sm"}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,value:p,onChange:h=>v(h.target.value),className:"p-2 rounded border border-slate-300 text-sm"})]}),e.jsx("button",{disabled:K,className:"w-full bg-blue-600 text-white py-2 rounded text-sm font-medium hover:bg-blue-700 transition",children:K?"Memproses...":"Buat User"})]}),e.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Username"}),e.jsx("th",{className:"p-3",children:"Role"}),e.jsx("th",{className:"p-3 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:j.map((h,S)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"p-3 text-slate-800",children:h.username}),e.jsx("td",{className:"p-3 text-slate-500 uppercase text-xs font-bold",children:h.role}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>I(h.id),className:"text-rose-500 hover:text-rose-700 p-1",children:e.jsx(W,{size:16})})})]},h.id))})]})})]}),m==="DATABASE"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(ye,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Koneksi MySQL"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Konfigurasi database server."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 text-sm",children:[e.jsx("p",{className:"mb-2 font-semibold",children:"Status Koneksi:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${A.isConnected?"bg-emerald-500":"bg-rose-500"}`}),e.jsx("span",{className:"text-slate-700",children:A.isConnected?"Terhubung":"Terputus"})]})]}),U&&e.jsxs("div",{className:`p-3 rounded-lg text-sm flex items-center gap-2 ${U.type==="success"?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:[U.type==="success"?e.jsx(Te,{size:16}):e.jsx(Fe,{size:16}),U.text]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{onClick:$,disabled:B,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white px-6 py-2.5 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[B?e.jsx(Se,{size:18,className:"animate-spin"}):e.jsx(ye,{size:18}),"Test Koneksi"]})})]})]})]})})]})},Tt=({onLogin:x,connectionStatus:g="CONNECTED"})=>{const[r,m]=l.useState(""),[o,u]=l.useState(""),[w,A]=l.useState(""),[C,j]=l.useState(!1),T=g==="CONNECTED",d=(()=>{switch(g){case"CONNECTED":return{text:"DB Connected",color:"bg-emerald-50 text-emerald-700 border-emerald-100",dot:"bg-emerald-500 animate-pulse"};case"DB_ERROR":return{text:"Database Tidak Konek Hubungi Admin",color:"bg-orange-50 text-orange-700 border-orange-100",dot:"bg-orange-500"};case"SERVER_ERROR":return{text:"Node JS Mati",color:"bg-rose-50 text-rose-700 border-rose-100",dot:"bg-rose-500"};default:return{text:"Checking...",color:"bg-slate-50 text-slate-500 border-slate-100",dot:"bg-slate-400"}}})(),p=async v=>{if(v.preventDefault(),!!T){j(!0),A("");try{const f=await(await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o})})).json();f.success&&f.token?x(f.user,f.token):A(f.message||"Login gagal")}catch{A("Gagal menghubungi server")}finally{j(!1)}}};return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4 relative overflow-hidden",children:e.jsxs("div",{className:`bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 transition-all duration-300 relative ${T?"":"filter blur-sm pointer-events-none"}`,children:[e.jsxs("div",{className:`absolute top-4 right-4 z-10 inline-flex items-center gap-2 px-2 py-1 rounded-full text-[10px] font-medium border shadow-sm transition-all duration-300 ${d.color}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${d.dot}`}),d.text]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"https://fin.dmasiv.id/img/logodmsv.png",alt:"D'MASIV Logo",className:"h-24 w-auto mx-auto mb-6 object-contain"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Selamat Datang"}),e.jsx("p",{className:"text-slate-500",children:"Sistem Finance D'MASIV"})]}),w&&e.jsxs("div",{className:"mb-4 p-3 bg-rose-50 border border-rose-200 text-rose-600 text-sm rounded-lg text-center font-medium flex items-center justify-center gap-2",children:[e.jsx(ae,{size:16})," ",w]}),e.jsxs("form",{onSubmit:p,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"text",value:r,onChange:v=>m(v.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan username",required:!0,disabled:!T})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"password",value:o,onChange:v=>u(v.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan password",required:!0,disabled:!isDbConnected})]})]}),e.jsx("button",{type:"submit",disabled:C||!isDbConnected,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed",children:C?"Memproses...":"Masuk Sistem"})]}),e.jsxs("div",{className:"mt-6 text-center text-xs text-slate-400",children:["Â© ",new Date().getFullYear()," D'MASIV Finance System"]})]})})},It=({authToken:x})=>{const[g,r]=l.useState([]),[m,o]=l.useState(!1),[u,w]=l.useState(!1),[A,C]=l.useState(!1),[j,T]=l.useState(""),[z,d]=l.useState(null),[p,v]=l.useState(null),[K,f]=l.useState(""),[E,R]=l.useState(""),[B,G]=l.useState(""),[U,n]=l.useState(""),[c,O]=l.useState(""),[D,L]=l.useState("");l.useEffect(()=>{x&&I()},[x]);const I=async()=>{d(null);try{const s=await fetch("/api/employees",{headers:{Authorization:`Bearer ${x}`}});if(!s.ok){const y=await s.text();throw new Error(`Server Error (${s.status}): ${y.substring(0,100)}`)}const N=await s.json();Array.isArray(N)?r(N):r([])}catch(s){console.error("Gagal load pegawai",s),d(s.message||"Gagal memuat data pegawai.")}},$=()=>{f(""),R(""),G(""),n(""),O(""),L(""),v(null),w(!1)},h=()=>{$(),o(!0)},S=s=>{f(s.name),R(s.position),G(s.phone),n(s.email),O(s.username),L(""),v(s.id),w(!0),o(!0)},M=async s=>{if(s.preventDefault(),!x)return;C(!0);const N={name:K,position:E,phone:B,email:U,username:c,password:D};try{let y="/api/employees",F="POST";u&&p&&(y=`/api/employees/${p}`,F="PUT");const J=await fetch(y,{method:F,headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(N)});if(!J.ok){const ee=await J.text();try{const se=JSON.parse(ee);throw new Error(se.message||`Gagal menyimpan (${J.status})`)}catch{throw new Error(`Server Error: ${ee.substring(0,150)}...`)}}const H=await J.json();H.success?(I(),o(!1),$(),alert(u?"Data berhasil diperbarui":"Pegawai berhasil ditambahkan")):alert(H.message||"Gagal menyimpan data.")}catch(y){console.error("Submit Error:",y),alert(y.message||"Terjadi kesalahan sistem saat menghubungi server.")}finally{C(!1)}},_=async s=>{if(confirm("Yakin ingin menghapus data pegawai ini?")&&x)try{const y=await(await fetch(`/api/employees/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${x}`}})).json();y.success?I():alert(y.message||"Gagal menghapus")}catch{alert("Gagal menghubungi server untuk menghapus.")}},X=g.filter(s=>s.name.toLowerCase().includes(j.toLowerCase())||s.position.toLowerCase().includes(j.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Data Pegawai"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kelola akses dan informasi pegawai."})]}),e.jsxs("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm font-medium transition-colors",children:[e.jsx(ie,{size:18})," Tambah Pegawai"]})]}),z&&e.jsxs("div",{className:"bg-rose-50 border border-rose-200 text-rose-700 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:20}),e.jsxs("span",{children:["Error: ",z]})]}),e.jsxs("button",{onClick:I,className:"text-sm font-bold underline hover:text-rose-900 flex items-center gap-1",children:[e.jsx(Se,{size:14})," Coba Lagi"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari nama atau jabatan...",value:j,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-100 transition-all"})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Total: ",g.length," Pegawai"]})]}),X.length===0&&!z?e.jsxs("div",{className:"text-center py-12 text-slate-400 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-200",children:[e.jsx(Y,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Belum ada data pegawai."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 group hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>S(s),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-slate-50 rounded",children:e.jsx(de,{size:16})}),e.jsx("button",{onClick:()=>_(s.id),className:"p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded",children:e.jsx(W,{size:16})})]})]}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white mb-1",children:s.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium text-sm mb-4 flex items-center gap-1",children:[e.jsx(he,{size:14})," ",s.position]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400 border-t border-slate-100 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:14,className:"text-slate-400"})," ",s.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:14,className:"text-slate-400"})," ",s.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:14,className:"text-slate-400"})," Login: ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-900 px-1 rounded",children:s.username})]})]})]},s.id))}),m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:u?"Edit Data Pegawai":"Tambah Pegawai Baru"}),e.jsx("button",{onClick:()=>o(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Z,{size:24})})]}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:K,onChange:s=>f(s.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jabatan"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:E,onChange:s=>R(s.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"No. HP / WA"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:B,onChange:s=>G(s.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,value:U,onChange:s=>n(s.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-4 mt-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:"Akses Login"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:c,onChange:s=>O(s.target.value),className:"w-full p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password ",u&&"(Opsional)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!u,value:D,onChange:s=>L(s.target.value),placeholder:u?"Biarkan kosong jika tetap":"",className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:A,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:A?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," Simpan Data"]})})]})]})]})})]})},Rt=({user:x,onLogout:g})=>{const r=x.details;return e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(he,{size:120})}),e.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm mb-1",children:Je()}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Halo, ",(r==null?void 0:r.name)||x.username]}),e.jsx("p",{className:"text-blue-100 opacity-90",children:(r==null?void 0:r.position)||"Staff"})]}),e.jsx("button",{onClick:g,className:"bg-white/20 p-2 rounded-full hover:bg-white/30 backdrop-blur-sm transition-colors",children:e.jsx(Me,{size:20})})]}),e.jsxs("div",{className:"flex gap-4 relative z-10",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1",children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"})," Aktif"]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1",children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Notifikasi"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx(Le,{size:14})," 0 Baru"]})]})]})]}),e.jsxs("div",{className:"px-4 -mt-8 relative z-20 space-y-6",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100",children:[e.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Y,{size:18,className:"text-blue-600"})," Data Diri"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(he,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Jabatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:(r==null?void 0:r.position)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600",children:e.jsx(Ee,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telepon / WhatsApp"}),e.jsx("p",{className:"font-medium text-slate-800",children:(r==null?void 0:r.phone)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600",children:e.jsx(Ae,{size:18})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"font-medium text-slate-800 truncate",children:(r==null?void 0:r.email)||"-"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100",children:[e.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(V,{size:18,className:"text-amber-500"})," Informasi"]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl text-center text-slate-500 text-sm",children:[e.jsx(oe,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"Belum ada pengumuman atau tugas khusus untuk Anda saat ini."})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-3 flex justify-around text-xs font-medium text-slate-400 z-50",children:[e.jsxs("button",{className:"flex flex-col items-center gap-1 text-blue-600",children:[e.jsx(Y,{size:20}),e.jsx("span",{children:"Profil"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 hover:text-slate-600",children:[e.jsx(Te,{size:20}),e.jsx("span",{children:"Tugas"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 hover:text-slate-600",children:[e.jsx(Le,{size:20}),e.jsx("span",{children:"Info"})]})]})]})},Dt=()=>{const[x,g]=l.useState(!1),[r,m]=l.useState(null),[o,u]=l.useState(null),[w,A]=l.useState(!1),[C,j]=l.useState("CONNECTED"),[T,z]=l.useState("DASHBOARD"),[d,p]=l.useState(!1);l.useEffect(()=>{const s=localStorage.getItem("dmasiv_user"),N=localStorage.getItem("dmasiv_token");s&&N&&(m(JSON.parse(s)),u(N),g(!0))},[]);const v=async()=>{try{const y=(await(await fetch("/api/test-db")).json()).status==="success";return j(y?"CONNECTED":"DB_ERROR"),y}catch{return j("SERVER_ERROR"),!1}};l.useEffect(()=>{v();const s=setInterval(async()=>{!await v()&&x&&f()},3e4);return()=>clearInterval(s)},[x]);const K=(s,N)=>{m(s),u(N),g(!0),localStorage.setItem("dmasiv_user",JSON.stringify(s)),localStorage.setItem("dmasiv_token",N)},f=()=>{localStorage.removeItem("dmasiv_user"),localStorage.removeItem("dmasiv_token"),g(!1),m(null),u(null),A(!1)},E=async(s,N={})=>{if(!o)return null;const y={...N.headers,Authorization:`Bearer ${o}`};try{const F=await fetch(s,{...N,headers:y});return F.status===401||F.status===403?(f(),null):F}catch(F){return console.error("Fetch Error:",F),null}},[R,B]=l.useState({categories:[],database:{host:"",user:"",password:"",name:"",port:"3306",isConnected:!1},drive:{isConnected:!1,selectedFolderId:"",selectedFolderName:"",autoUpload:!1}}),G=s=>B(s),[U,n]=l.useState([]),[c,O]=l.useState([]),D=async s=>{const N=await E(s);if(!N)return null;const y=await N.text();try{return JSON.parse(y)}catch{return null}};l.useEffect(()=>{x&&C==="CONNECTED"&&o&&(r==null?void 0:r.role)!=="employee"&&(async()=>{const N=await D("/api/transactions");Array.isArray(N)&&n(N);const y=await D("/api/reimbursements");Array.isArray(y)&&O(y);const F=await D("/api/categories"),J=await D("/api/settings");B(H=>({...H,categories:Array.isArray(F)?F:[],drive:(J==null?void 0:J.drive)||H.drive,database:{...H.database,isConnected:!0}}))})()},[x,C,o,r]);const L=async s=>{n(N=>[s,...N]),await E("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})},I=async s=>{n(N=>N.filter(y=>y.id!==s)),await E(`/api/transactions/${s}`,{method:"DELETE"})},$=async s=>{n(N=>N.map(y=>y.id===s.id?s:y)),await E(`/api/transactions/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})},h=async s=>{O(N=>[s,...N]),await E("/api/reimbursements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})},S=async s=>{O(N=>N.filter(y=>y.id!==s)),await E(`/api/reimbursements/${s}`,{method:"DELETE"})},M=async s=>{O(N=>N.map(y=>y.id===s.id?s:y)),await E(`/api/reimbursements/${s.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})},_=async s=>{O(N=>N.map(y=>y.id===s.id?s:y)),await E(`/api/reimbursements/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s.status,rejectionReason:s.rejectionReason})})},X=()=>{const s={authToken:o};switch(T){case"DASHBOARD":return e.jsx(ue,{transactions:U,reimbursements:c,isDarkMode:!1,filterType:"ALL"});case"STAT_EXPENSE":return e.jsx(ue,{transactions:U,reimbursements:c,isDarkMode:!1,filterType:"EXPENSE"});case"ADD_EXPENSE":return e.jsx(ke,{onAddTransaction:L,onDeleteTransaction:I,onUpdateTransaction:$,transactions:U,defaultType:"PENGELUARAN",filterType:"PENGELUARAN",initialView:"LIST",categories:R.categories,...s});case"REIMBURSE":return e.jsx(Ct,{reimbursements:c,onAddReimbursement:h,onDeleteReimbursement:S,onUpdateReimbursementDetails:M,onUpdateReimbursement:_,categories:R.categories,...s});case"REPORT_EXPENSE":return e.jsx(Oe,{transactions:U,reimbursements:c,fixedFilterType:"PENGELUARAN",categories:R.categories});case"ADD_INCOME":return e.jsx(ke,{onAddTransaction:L,onDeleteTransaction:I,onUpdateTransaction:$,transactions:U,defaultType:"PEMASUKAN",filterType:"PEMASUKAN",initialView:"LIST",categories:R.categories,...s});case"STAT_INCOME":return e.jsx(ue,{transactions:U,reimbursements:c,isDarkMode:!1,filterType:"INCOME"});case"JOURNAL_LIST":return e.jsx(ke,{onAddTransaction:L,onDeleteTransaction:I,onUpdateTransaction:$,transactions:U,defaultType:"PENGELUARAN",initialView:"LIST",categories:R.categories,...s});case"REPORT":return e.jsx(Oe,{transactions:U,reimbursements:c,categories:R.categories});case"EMPLOYEES":return e.jsx(It,{...s});case"SETTINGS":return e.jsx(Pt,{settings:R,onUpdateSettings:G,...s});default:return e.jsx(ue,{transactions:U,reimbursements:c,isDarkMode:!1})}};return x?(r==null?void 0:r.role)==="employee"?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{user:r,onLogout:()=>A(!0)}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(Ue,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Anda yakin ingin keluar?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>A(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:f,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Keluar"})]})]})})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 text-slate-900 font-sans",children:[e.jsx(St,{user:r,onLogoutClick:()=>A(!0),toggleSidebar:()=>p(!d),connectionStatus:C}),e.jsxs("div",{className:"flex flex-1 pt-16 overflow-hidden",children:[e.jsx(At,{activePage:T,setActivePage:z,isOpen:d,setIsOpen:p}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:X()})}),e.jsx("div",{className:"shrink-0 z-20",children:e.jsx(Et,{})})]})]}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(Ue,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Apakah Anda yakin ingin keluar dari sistem?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>A(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:f,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Ya, Keluar"})]})]})})]}):e.jsx(Tt,{onLogin:K,connectionStatus:C})},He=document.getElementById("root");if(!He)throw new Error("Could not find root element to mount to");const Lt=Ce.createRoot(He);Lt.render(e.jsx(jt.StrictMode,{children:e.jsx(Dt,{})}));
